# Property Schema to Portal Search Flow

## Visual Flow Diagram

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                    PROPERTY SCHEMA TO PORTAL SEARCH FLOW                       â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                              INPUT: PROPERTY SCHEMA                            â”‚
â”‚                                                                                 â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚
â”‚  â”‚                    property_schema.json                                â”‚   â”‚
â”‚  â”‚                                                                       â”‚   â”‚
â”‚  â”‚  {                                                                   â”‚   â”‚
â”‚  â”‚    "address": "CALLE 145 #23-06 Edf Genesis Cedritos",              â”‚   â”‚
â”‚  â”‚    "operation": "ARRIENDO",                                          â”‚   â”‚
â”‚  â”‚    "area_habitable": 37.42,                                          â”‚   â”‚
â”‚  â”‚    "bedrooms": 1,                                                    â”‚   â”‚
â”‚  â”‚    "bathrooms": 1.0,                                                 â”‚   â”‚
â”‚  â”‚    "parking": 1,                                                     â”‚   â”‚
â”‚  â”‚    "stratum": 4,                                                     â”‚   â”‚
â”‚  â”‚    "construction_age": 29,                                           â”‚   â”‚
â”‚  â”‚    "elevator": true,                                                 â”‚   â”‚
â”‚  â”‚    "floor": 4,                                                       â”‚   â”‚
â”‚  â”‚    "pricing": {                                                      â”‚   â”‚
â”‚  â”‚      "price_per_m2": 49439,                                          â”‚   â”‚
â”‚  â”‚      "area": 37.42                                                   â”‚   â”‚
â”‚  â”‚    }                                                                 â”‚   â”‚
â”‚  â”‚  }                                                                   â”‚   â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                                        â”‚
                                        â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                            MAPPING LAYER: PORTAL MAPPERS                       â”‚
â”‚                                                                                 â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”          â”‚
â”‚  â”‚ Fincaraiz   â”‚  â”‚Metrocuadradoâ”‚  â”‚ Ciencuadras â”‚  â”‚  Properati  â”‚          â”‚
â”‚  â”‚   Mapper    â”‚  â”‚   Mapper    â”‚  â”‚   Mapper    â”‚  â”‚   Mapper    â”‚          â”‚
â”‚  â”‚             â”‚  â”‚             â”‚  â”‚             â”‚  â”‚             â”‚          â”‚
â”‚  â”‚ âœ… IMPL     â”‚  â”‚ ğŸ“‹ TODO     â”‚  â”‚ ğŸ“‹ TODO     â”‚  â”‚ ğŸ“‹ TODO     â”‚          â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜          â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                                        â”‚
                                        â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                        OUTPUT: PORTAL-SPECIFIC SEARCH QUERIES                  â”‚
â”‚                                                                                 â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚
â”‚  â”‚                           FINCARAIZ OUTPUT                             â”‚   â”‚
â”‚  â”‚                                                                       â”‚   â”‚
â”‚  â”‚  URL: https://www.fincaraiz.com.co/buscar?                           â”‚   â”‚
â”‚  â”‚       tipo_operacion=arriendo&                                       â”‚   â”‚
â”‚  â”‚       tipo_inmueble=apartamento&                                     â”‚   â”‚
â”‚  â”‚       precio_min=1387505&                                            â”‚   â”‚
â”‚  â”‚       precio_max=2312509&                                            â”‚   â”‚
â”‚  â”‚       area_min=29&                                                   â”‚   â”‚
â”‚  â”‚       area_max=44&                                                   â”‚   â”‚
â”‚  â”‚       alcobas_min=1&                                                 â”‚   â”‚
â”‚  â”‚       alcobas_max=2&                                                 â”‚   â”‚
â”‚  â”‚       banos_min=1&                                                   â”‚   â”‚
â”‚  â”‚       banos_max=1.5&                                                 â”‚   â”‚
â”‚  â”‚       parqueadero=si&                                                â”‚   â”‚
â”‚  â”‚       estrato=4&                                                     â”‚   â”‚
â”‚  â”‚       antiguedad=usado&                                              â”‚   â”‚
â”‚  â”‚       ascensor=si&                                                   â”‚   â”‚
â”‚  â”‚       piso=4                                                         â”‚   â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚
â”‚                                                                                 â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚
â”‚  â”‚                        METROCUADRADO OUTPUT (TODO)                     â”‚   â”‚
â”‚  â”‚                                                                       â”‚   â”‚
â”‚  â”‚  URL: https://www.metrocuadrado.com/buscar?                           â”‚   â”‚
â”‚  â”‚       operacion=arriendo&                                             â”‚   â”‚
â”‚  â”‚       tipo_inmueble=apartamento&                                      â”‚   â”‚
â”‚  â”‚       precio_min=1387505&                                             â”‚   â”‚
â”‚  â”‚       precio_max=2312509&                                             â”‚   â”‚
â”‚  â”‚       area_min=29&                                                    â”‚   â”‚
â”‚  â”‚       area_max=44&                                                    â”‚   â”‚
â”‚  â”‚       alcobas=1&                                                      â”‚   â”‚
â”‚  â”‚       banos=1&                                                        â”‚   â”‚
â”‚  â”‚       parqueadero=si&                                                 â”‚   â”‚
â”‚  â”‚       estrato=4                                                       â”‚   â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚
â”‚                                                                                 â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚
â”‚  â”‚                         CIENCUADRAS OUTPUT (TODO)                      â”‚   â”‚
â”‚  â”‚                                                                       â”‚   â”‚
â”‚  â”‚  URL: https://www.ciencuadras.com/buscar-inmuebles?                   â”‚   â”‚
â”‚  â”‚       tipo_operacion=arriendo&                                        â”‚   â”‚
â”‚  â”‚       tipo_inmueble=apartamento&                                      â”‚   â”‚
â”‚  â”‚       precio_min=1387505&                                             â”‚   â”‚
â”‚  â”‚       precio_max=2312509&                                             â”‚   â”‚
â”‚  â”‚       area_min=29&                                                    â”‚   â”‚
â”‚  â”‚       area_max=44&                                                    â”‚   â”‚
â”‚  â”‚       alcobas=1&                                                      â”‚   â”‚
â”‚  â”‚       banos=1&                                                        â”‚   â”‚
â”‚  â”‚       parqueadero=si&                                                 â”‚   â”‚
â”‚  â”‚       estrato=4                                                       â”‚   â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚
â”‚                                                                                 â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚
â”‚  â”‚                          PROPERATI OUTPUT (TODO)                       â”‚   â”‚
â”‚  â”‚                                                                       â”‚   â”‚
â”‚  â”‚  URL: https://www.properati.com.co/buscar?                            â”‚   â”‚
â”‚  â”‚       operation=rent&                                                 â”‚   â”‚
â”‚  â”‚       property_type=apartment&                                        â”‚   â”‚
â”‚  â”‚       min_price=1387505&                                              â”‚   â”‚
â”‚  â”‚       max_price=2312509&                                              â”‚   â”‚
â”‚  â”‚       min_area=29&                                                    â”‚   â”‚
â”‚  â”‚       max_area=44&                                                    â”‚   â”‚
â”‚  â”‚       bedrooms=1&                                                     â”‚   â”‚
â”‚  â”‚       bathrooms=1&                                                    â”‚   â”‚
â”‚  â”‚       parking=si&                                                     â”‚   â”‚
â”‚  â”‚       stratum=4                                                       â”‚   â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

## Key Transformations

### 1. Operation Type Mapping
```
Property Schema â†’ Portal Specific
â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
"ARRIENDO"     â†’ "arriendo" (Fincaraiz, Metrocuadrado, Ciencuadras)
"ARRIENDO"     â†’ "rent" (Properati)
"VENTA"        â†’ "venta" (Fincaraiz, Metrocuadrado, Ciencuadras)
"VENTA"        â†’ "sale" (Properati)
```

### 2. Parameter Name Mapping
```
Property Schema â†’ Fincaraiz â†’ Metrocuadrado â†’ Ciencuadras â†’ Properati
â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
operation      â†’ tipo_operacion â†’ operacion â†’ tipo_operacion â†’ operation
bedrooms       â†’ alcobas â†’ alcobas â†’ alcobas â†’ bedrooms
bathrooms      â†’ banos â†’ banos â†’ banos â†’ bathrooms
stratum        â†’ estrato â†’ estrato â†’ estrato â†’ stratum
```

### 3. Tolerance Calculations
```
Property Schema Value â†’ Portal Search Range
â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
area_habitable: 37.42 â†’ area_min: 29, area_max: 44 (Â±20%)
price_per_m2: 49439   â†’ precio_min: 1387505, precio_max: 2312509 (Â±25%)
bedrooms: 1           â†’ alcobas_min: 1, alcobas_max: 2 (Â±1)
bathrooms: 1.0        â†’ banos_min: 1, banos_max: 1.5 (Â±0.5)
```

## Implementation Status

### âœ… Fincaraiz Mapper (Complete)
- **File**: `src/real_estate_analytics/mappers/fincaraiz_mapper.py`
- **Test**: `tests/unit/test_fincaraiz_mapper.py`
- **Features**: Complete parameter mapping, tolerance calculation, location extraction
- **Status**: Fully functional and tested

### ğŸ“‹ Remaining Mappers (To Implement)
- **Metrocuadrado Mapper**: Similar to Fincaraiz but with different parameter names
- **Ciencuadras Mapper**: Different URL structure and parameter names
- **Properati Mapper**: English parameter names, different URL structure

## Next Steps

1. **Create base mapper class** for common functionality
2. **Implement Metrocuadrado mapper** following Fincaraiz pattern
3. **Implement Ciencuadras mapper** with portal-specific logic
4. **Implement Properati mapper** with English parameter mapping
5. **Create mapper factory** to instantiate correct mapper based on portal
6. **Add comprehensive error handling** and validation
7. **Create integration tests** for all mappers

## Usage Pattern

```python
# 1. Load property data (following property_schema.json)
property_data = {...}

# 2. Initialize appropriate mapper
mapper = FincaraizMapper()  # or MetrocuadradoMapper(), etc.

# 3. Generate search query
search_result = mapper.map_property_to_search(property_data)

# 4. Extract search URL for web scraping
search_url = search_result['search_url']
```

This architecture provides a clean separation of concerns and makes it easy to add new portals by implementing the mapper interface.
